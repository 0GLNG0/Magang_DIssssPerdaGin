<!DOCTYPE html>
<html lang="en">

<head>

     <title>DISPERDAGIN | Dinas Perdagangan Dan Industri</title>

     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=Edge">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     <link rel="stylesheet" href="css/bootstrap.min.css">
     <link rel="stylesheet" href="css/font-awesome.min.css">
     <link rel="stylesheet" href="css/aos.css">
     <link rel="stylesheet" href="css/owl.carousel.min.css">
     <link rel="stylesheet" href="css/owl.theme.default.min.css">
     <!-- <link rel="stylesheet" href="css/style.css"> -->
     <link rel="shorcut icon" href="images/lpicon2.png">

     <!-- MAIN CSS -->
     <link rel="stylesheet" href="css/templatemo-digital-trend.css">

</head>

<body>

     <div class="loading-screen">
          <div class="loader"></div>
     </div>
     <!-- MENU BAR -->
     <!-- /*---------------------------------------
 Navbar         
-----------------------------------------*/ -->
     <nav class="navbar banner">
          <div class="row">
               <div class="col">
                    <a href="index.php">
                         <div class="logo">
                              <img src="images/dp1.png" alt="logo" style="height: 70px;">
                         </div>
                    </a>
               </div>
          </div>
          <div class="row right-side">
               <div class="col">
                    <p class="text-light mx-1">Kediri harmoni</p>
               </div>
               <div class="col">
                    <form class="d-flex bg-light f-search rounded" role="search">
                         <input type="text" placeholder="Find" class="border-0 rounded">
                         <button class="btn border-0 bg-white py-0 px-0" type="submit"><img src="images/search-icons.png" class="border-0 search-icons my-auto gb-white" alt=""></button>
                    </form>
               </div>
          </div>
     </nav>

     <nav class="navbar bg-white navbar-expand-sm position-sticky shadow shadow-sm">
          <div class="row">
               <div class="col">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                         <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                         <ul class="navbar-nav mx-0 px-0">
                              <li class="nav-item">
                                   <a href="index.php" class="">
                                        <img src="images/home-48px.png" class="img-thumbnail home border-0 my-0" alt="">
                                   </a>
                              </li>
                              <li class="nav-item">
                                   <a href="#project" class="nav-link smoothScroll ">Berita</a>
                              </li>
                              <li class="nav-item">
                                   <a href="#" class="nav-link" id="informasi-dropdown-toggle">Informasi</a>
                                   <ul class="isi-dropdown" id="informasi-dropdown">
                                        <li><a href="informasi-pasar.php">Informasi Pasar</a></li>
                                        <li><a href="pasar.html">Pasar</a></li>
                                        <li class="nav-item">
                                             <a href="minimarket.php" class=" ">minimarket</a>
                                        </li>
                                        <li><a href="mall.html">Mall</a></li>
                                        <li><a href="ikm.html">Industri Kecil Menengah</a></li>
                                   </ul>

                              </li>
                              <li class="nav-item">
                                   <a href="#" class="nav-link">Layanan</a>
                                   <ul class="isi-dropdown" id="layanan-dropdown">
                                        <li><a href="https://banmod.indagkediri.online/home.html" target="_blank">Bantuan
                                                  Modal</a>
                                        </li>
                                        <!-- <li><a href="#">Izin Tempat Penjualan Minuman Beralkohol</a></li> -->
                                        <li><a href="merk.html">Legalitas Merk</a></li>
                                        <li><a href="halal.html">Sertifikasi Halal</a></li>
                                        <li><a href="sinas.html">Sinas</a></li>
                                        <li><a href="tera.html">Tera/Tera Ulang</a></li>
                                   </ul>
                              </li>
                              <li class="nav-item">
                                   <a href="https://pusakaumkm.id/home/" class="nav-link" target="_blank">Produk
                                        Unggulan</a>
                              </li>

                              <li class="nav-item">
                                   <a href="#" class="nav-link smoothScroll">Unduhan</a>
                              </li>
                              <li class="nav-item">
                                   <a href="contact.php" class="nav-link ">Kontak</a>
                              </li>
                              <li class="nav-item">
                                   <a href="contact.php" class="nav-link ">Greate Sale</a>
                              </li>
                              <li class="nav-item">
                                   <a href="surveyPasar/index.php" class="nav-link ">Survey</a>
                              </li>
                              <div class="row px-5">
                                   <div class="col px-5">
                                        <ul class="navbar-nav float-right">
                                             <li class="nav-item">
                                                  <a href="https://www.instagram.com/disperdagin_kotakediri?igsh=ZDhvNmF0NXlpempr" target="blank">
                                                       <img src="images/ig-icons.png" class="img-thumbnail w-75 border-0" alt="">
                                                  </a>
                                             </li>
                                             <li class="nav-item">
                                                  <a href="https://www.instagram.com/disperdagin_kotakediri?igsh=ZDhvNmF0NXlpempr" target="blank">
                                                       <img src="images/fb-icons.png" class="img-thumbnail w-75 border-0" alt="">
                                                  </a>
                                             </li>
                                        </ul>
                                   </div>
                              </div>



                              <div class="scroll-up-icon">
                                   <i class="fa fa-arrow-up"></i>
                              </div>

                              <div class="fa-eye-icon">
                                   <button class="btn" type="button" data-toggle="modal" data-target="#exampleModal">
                                        <img src="images/massage.png" class="w-50" alt="">
                                   </button </div>
                         </ul>
                    </div>
               </div>
          </div>
     </nav>

     <!-- /*---------------------------------------
 data dan grafik 
-----------------------------------------*/ -->
     <!-- PROJECT -->
     <!-- data dan grafik -->
     <div class="container">
          <div class="row">
               <div class="col-lg-6 col-md-7 col-12">
                    <h1> <strong class="gradient-text" data-aos="fade-up" data-aos-delay="100">Informasi Harga Komoditas
                              Pasar dan Grafik Harga</strong></h1>

                    <div class="quote" data-aos="fade-up" data-aos-delay="200"></div>

                    <h3 class="mb-4" data-aos="fade-up" data-aos-delay="300">Berikut adalah Informasi harga Komoditas
                         dan Grafik Pasar</h3>
               </div>
          </div>
          <section class="about section-padding pb-0">
               <div class="container ">
                    <?php
                    $conn = mysqli_connect('localhost', 'root', '', 'data_harga_pokok');

                    $sql = "SELECT DISTINCT
               data_harga_barang.nama_barang,
               data_harga_barang.tanggal,
               data_harga_barang.harga_sekarang
            FROM
               data_harga_barang
            ORDER BY
                nama_barang, tanggal";

                    $result = mysqli_query($conn, $sql);
                    ?>
                    <?php
                    $conn = mysqli_connect('localhost', 'root', '', 'data_harga_pokok');

                    if ($conn->connect_error) {
                         die("Koneksi gagal: " . $conn->connect_error);
                    }
                    ?>
                    <div class="container p-2 border border-dark rounded" data-aos="fade-up" data-aos-delay="100">
                         <?php
                         echo "<tr><td colspan='2' class='selected-item'>Jumlah item yang dipilih: <span id='selected-count'>0</span></td></tr>";
                         ?>
                         <form method="post" action="datafiltered.php">
                              <table>
                                   <tr>
                                        <?php
                                        $query_checkbox = "SELECT DISTINCT nama_barang FROM data_barang_bandar";
                                        $result_checkbox = $conn->query($query_checkbox);

                                        if ($result_checkbox->num_rows > 0) {
                                             echo "<tr><th><label><input type='checkbox' id='select-all'> Select All</label></th></tr>";
                                             while ($row_checkbox = $result_checkbox->fetch_assoc()) {
                                                  $field_data = $row_checkbox['nama_barang'];
                                                  echo "<tr><label><input type='checkbox' name='filter[]' value='$field_data'> $field_data</label></tr>";
                                             }
                                        } else {
                                             echo "Tidak ada data untuk ditampilkan.";
                                        }
                                        ?>
                                        <br>
                                        <script>
                                             // fungsi select all
                                             document.getElementById('select-all').addEventListener('change', function() {
                                                  var checkboxes = document.querySelectorAll("input[name='filter[]']");
                                                  checkboxes.forEach(function(checkbox) {
                                                       checkbox.checked = document.getElementById('select-all').checked;
                                                  });
                                                  updateSelectedCount();
                                             });

                                             // fungsi check box
                                             var checkboxes = document.querySelectorAll("input[name='filter[]']");
                                             checkboxes.forEach(function(checkbox) {
                                                  checkbox.addEventListener('change', function() {
                                                       updateSelectedCount();
                                                  });
                                             });

                                             // fungsi count select
                                             function updateSelectedCount() {
                                                  var selectedCheckboxes = document.querySelectorAll("input[name='filter[]']:checked");
                                                  document.getElementById('selected-count').innerText = selectedCheckboxes.length;
                                             }
                                        </script>
                              </table>
                              <button type="submit" value="Filter" class="button blob btn-primary btn">
                                   <span>Filter</span>
                              </button>
                         </form>
                    </div>

                    <!-- fiilter untuk rentang tanggal -->
                    <div class="contaier">
                         <h2 class="d-flex justify-content-center mt-5" data-aos="fade-up" data-aos-delay="200">Data
                              Tabel Harga Barang</h2>
                         <div class="gx-5 d-flex justify-content-center my-5" data-aos="fade-up">
                              <div class="border border-dark rounded px-4 py-4  my-5">
                                   <p>Pilih tanggal untuk menampilkan data tabel</p>
                                   <span for="tanggal" id="inputGroup-sizing-sm" class="input-group-text">Pilih
                                        tanggal:</span>
                                   <input type="date" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm" id="tanggal">
                                   <div class="mt-2" id="hasil"></div>
                              </div>
                         </div>
                    </div>
                    <div class="text-center py-5">
                         <h1>PERKEMBANGAN HARGA</h1>
                    </div>

                    <?php
                    $conn = mysqli_connect('localhost', 'root', '', 'data_harga_pokok');

                    if (mysqli_connect_errno()) {
                         echo "Koneksi database gagal: " . mysqli_connect_error();
                         exit();
                    }
                    // memanggil data json
                    $jsonData = file_get_contents('images/komoditas/gambar_komo.json');
                    $jsonData = utf8_decode($jsonData);
                    // ubah data json menjadi array asosiaytif
                    $komoditas = json_decode($jsonData, true);

                    // loop     
                    // percobaan ke empat untuk menampilkan harga tapi yg terbaru
                    $qry = "SELECT nama_barang, harga_sekarang, tanggal ,harga_kemarin,selisih
FROM (
    SELECT nama_barang, harga_sekarang,harga_kemarin,selisih, tanggal,
           ROW_NUMBER() OVER (PARTITION BY nama_barang ORDER BY tanggal DESC) AS rn
    FROM data_barang_bandar
) AS ranked
WHERE rn = 1 AND nama_barang IN ('Beras premium', 'Beras Medium', 'Telur Ayam ras', 'Cabe Merah Keriting', 'Cabe Merah Besar');"


                    ?>
                    <div class="container ">
                         <div class="row d-flex justify-content-center">

                              <?php

                              $result = mysqli_query($conn, $qry);
                              // =================
                              // percobaan ke dua
                              // =================
                              // $total_data = count($komoditas);
                              // $i = 0;
                              // while ($i < $total_data) {
                              //      $gambar = $komoditas[$i]['gambar'];
                              //      echo "<img src='$gambar'>";
                              //  }


                              foreach ($komoditas as $value) {
                                   $gambar = $value['gambar'];


                                   if (mysqli_num_rows($result) > 0) {
                                        while ($row = mysqli_fetch_assoc($result)) {
                                             $nama_barang = $row["nama_barang"];
                                             $harga_sekarang = $row["harga_sekarang"];
                                             $harga_kemarin = $row["harga_kemarin"];
                                             $selisih = $harga_sekarang - $harga_sekarang;
                                             $selisih = $row["selisih"];
                                             if ($harga_sekarang > $harga_kemarin) {
                                                  $keterangan = "images/project/project-detail/naik.png";
                                                  $selisih = "<p class='card-title mb-1 text-success'>Rp.$selisih</p>";
                                             } else if ($harga_sekarang < $harga_kemarin) {
                                                  $keterangan = "images/project/project-detail/turun.png";
                                                  $selisih = "<p class='card-title mb-1 text-danger'>Rp.$selisih</p>";
                                             } else {
                                                  $keterangan = "images/project/project-detail/sama.png";
                                                  $selisih = "<p class='card-title mb-1 text-warning'>Rp.$selisih</p>";
                                             };
                                             echo
                                             "<div class='col-4 my-5'>
                <div class='card border-0 bg-white'>
                    <div class='card-img'>
                        <img src='$gambar' class='img-komo border-3 p-0'' alt=''>
                    </div>
                    <div class='card-img-overlay bg-white head px-1 mb-0 border-0'>
                        <p class=' text-center mb-0 mt-0 px-0 mx-0'>$nama_barang</p>
                        <hr class='border border-black border-2 my-0'>
                    <div class='row gx-1 d-flex justify-content-center'>
                        <div class='col py-1'>
                        <p class='card-title mb-1'>Rp.$harga_sekarang</p>
                        <img src='$keterangan' class='ml-3'>
                        </div>
                        <div class='col py-1'>
                        <p class='card-title fw-bold mb-2'>Sebelumnya</p>
                        <p class='card-title mb-1 text-silent'>Rp.$harga_kemarin</p>
                        $selisih
                        </div>
                    </div>
                </div>
            </div>
        </div>";
                                        }
                                   }
                              }
                              ?>
                         </div>
                         <div class="d-flex justify-content-center">
                              <a href="informasi-pasar.php" class="btn more">More infomation</a>
                         </div>
                    </div>
</body>

</html>
</div>
</section>
</div>

<footer class="site-footer">
     <div class="container">
          <div class="row">

               <div class="col-lg-3 mx-5">
                    <img src="images/dp1.png" class=" footer-imgae" alt="">
               </div>
               <div class="f-line"></div>

               <div class="col-lg-3 " data-aos="fade-up" data-aos-delay="200">
                    <h4 class="my-4 text-white">Kantor Kami</h4>
                    <p class="mb-0 footer-text text-white mx-3">
                         <i class="fa fa-home mr-2 footer-icon text-white">
                         </i>
                         Jl. Penanggungan NO. 7, Bandar Lor, Kec. Mojoroto, Kota Kediri, Jawa Timur
                    </p>
               </div>
               <div class="col-lg-3 text-left" data-aos="fade-up" data-aos-delay="200">

                    <h4 class="my-4 text-white">Hubungi Kami</h4>

                    <p class="text-left text-white">
                         <i class="fa fa-phone footer-icon"></i>
                         +99 080 070 4224
                    </p>

                    <p class="text-white text-left">
                         <a href="#" class="text-white">
                              <i class="fa fa-envelope footer-icon"></i>
                              DISSSSttttt@gmail.com
                         </a>
                    </p>
                    <p>
                    <ul class="social-icon">
                         <li><a href="#" class="fa fa-instagram text-white"></a></li>
                         <li><a href="#" class="fa fa-twitter text-white"></a></li>
                    </ul>
                    </p>
               </div>
               <div class="f-line"></div>
               <div class="col">
                    <p class="text-white text-left">Statistik</p>
                    <div class="px-0">
                         <i class="fa text-white">
                              <?php
                              // koneksi
                              $conn = mysqli_connect('localhost', 'root', '', 'db_dispendagrin');

                              // pilih database
                              $count_query = mysqli_query($conn, "SELECT * FROM tb_counter");

                              // logika
                              if ($count_query) {
                                   $row = mysqli_fetch_array($count_query);
                                   $current_count = $row['counts'];
                                   $new_count = $current_count + 1;
                                   $update_count = mysqli_query($conn, "UPDATE tb_counter SET counts = '" . $new_count . "'");
                                   echo $new_count;
                              } else {
                                   echo "Error: " . mysqli_error($conn);
                              }

                              // close connection
                              mysqli_close($conn);
                              ?>
                              /Hari
                         </i>
                    </div>
               </div>
          </div>

     </div>

     <div class="mx-auto Copyright">
          <p class="copyright-text mt-5 text-white">Copyright &copy; 2023 DISPERDAGIN
               <br>
     </div>
</footer>


<!-- SCRIPTS -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/aos.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/smoothscroll.js"></script>
<script src="js/custom.js"></script>
<script src="js/transition.js"></script>
<script src="js/loader.js"></script>
<script src="js/date-filter.js"></script>

<script>
     document.addEventListener('DOMContentLoaded', function() {
          var scrollUpIcon = document.querySelector('.scroll-up-icon');

          // Tampilkan tombol ketika pengguna menggulir ke bawah
          window.addEventListener('scroll', function() {
               if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    scrollUpIcon.style.display = 'block';
               } else {
                    scrollUpIcon.style.display = 'none';
               }
          });

          // Smooth scroll ke atas ketika tombol diklik
          scrollUpIcon.addEventListener('click', function() {
               smoothScrollToTop();
          });

          // Fungsi untuk melakukan smooth scroll ke atas
          function smoothScrollToTop() {
               var currentPosition = document.documentElement.scrollTop || document.body.scrollTop;
               if (currentPosition > 0) {
                    window.requestAnimationFrame(smoothScrollToTop);
                    window.scrollTo(0, currentPosition - currentPosition / 8);
               }
          }
     });
</script>

<script>
     document.addEventListener('DOMContentLoaded', function() {
          // Tombol toggle dropdown minimarket
          var minimarketToggle = document.getElementById('minimarket-dropdown-toggle');
          // Dropdown minimarket
          var minimarketDropdown = document.getElementById('minimarket-dropdown');

          // Tampilkan dropdown minimarket ketika tombol toggle diklik
          minimarketToggle.addEventListener('click', function() {
               if (minimarketDropdown.style.display === 'none' || minimarketDropdown.style.display === '') {
                    minimarketDropdown.style.display = 'block';
               } else {
                    minimarketDropdown.style.display = 'none';
               }
          });

          // Sembunyikan dropdown minimarket saat klik di luar dropdown
          document.addEventListener('click', function(event) {
               var targetElement = event.target;
               if (targetElement !== minimarketToggle && targetElement !== minimarketDropdown) {
                    minimarketDropdown.style.display = 'none';
               }
          });
     });
</script>


</body>

</html>