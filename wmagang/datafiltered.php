<!DOCTYPE html>
<html lang="en">

<head>

     <title>DISPERDAGIN | Dinas Perdagangan Dan Industri</title>

     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=Edge">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     <link rel="stylesheet" href="css/bootstrap.min.css">
     <link rel="stylesheet" href="css/font-awesome.min.css">
     <link rel="stylesheet" href="css/aos.css">
     <link rel="stylesheet" href="css/owl.carousel.min.css">
     <link rel="stylesheet" href="css/owl.theme.default.min.css">
     <link rel="shorcut icon" href="images/lpicon2.png">
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

     <!-- MAIN CSS -->
     <link rel="stylesheet" href="css/templatemo-digital-trend.css">

</head>

<body>

     <div class="loading-screen">
          <div class="loader"></div>
     </div>
     <!-- MENU BAR -->
     <!-- , ISI,Layanan(Dropdown), Zona Integritas, UNDUHAN-->
     <nav class="navbar banner">
          <div class="row">
               <div class="col">
                    <a href="index.php" >
                         <div class="logo">
                              <img src="images/dp1.png" alt="logo" style="height: 70px;">
                         </div>
                    </a>
               </div>
               <!-- <div class="col col-md-6 mx-1">
                    </div> -->
               </div>
                    <div class="row">
                         <div class="col">
                              <p class="text-light mx-1">Kediri harmoni</p>
                         </div>
                         <div class="col">
                              <form class="d-flex" role="search">
                                   <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                                   <button class="btn btn-outline-success" type="submit">Search</button>
                              </form>
                         </div>
                    </div>
     </nav>

     <nav class="navbar navbar-expand-lg position-sticky shadow shadow-sm bg-white">
          <div class="row">
          <div class="col">
     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
               aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
               <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse"  id="navbarNav">
               <ul class="navbar-nav m-auto" >
                    <li class="nav-item">
                         <a href="index.php" class="">
                         <img src="images/home-48px.png" class="img-thumbnail w-75 border-0" alt="">
                         </a>
                    </li>
                    <li class="nav-item">
                         <a href="#project" class="nav-link smoothScroll">Berita</a>
                    </li>
                    <li class="nav-item">
                         <a href="#" class="nav-link" id="informasi-dropdown-toggle">Informasi</a>
                         <ul class="isi-dropdown" id="informasi-dropdown">
                              <li><a href="informasi-pasar.php">Informasi Pasar</a></li>
                              <li><a href="pasar.html">Pasar</a></li>
                              <li>
                                   <a href="#" id="minimarket-dropdown-toggle">Minimarket</a>
                                   <ul class="isi-drop" id="minimarket-dropdown">
                                        <li><a href="indomaret.html">Indomaret</a></li>
                                        <li><a href="alfamart.html">Alfamart</a></li>
                                   </ul>
                              </li>
                              <li><a href="mall.html">Mall</a></li>
                              <li><a href="ikm.html">Industri Kecil Menengah</a></li>
                         </ul>

                    </li>
                    <li class="nav-item">
                         <a href="#" class="nav-link">Layanan</a>
                         <ul class="isi-dropdown" id="layanan-dropdown">
                              <li><a href="https://banmod.indagkediri.online/home.html" target="_blank">Bantuan
                                        Modal</a>
                              </li>
                              <!-- <li><a href="#">Izin Tempat Penjualan Minuman Beralkohol</a></li> -->
                              <li><a href="merk.html">Legalitas Merk</a></li>
                              <li><a href="halal.html">Sertifikasi Halal</a></li>
                              <li><a href="sinas.html">Sinas</a></li>
                              <li><a href="tera.html">Tera/Tera Ulang</a></li>
                         </ul>
                    </li>
                    <li class="nav-item">
                         <a href="https://pusakaumkm.id/home/" class="nav-link" target="_blank">Produk Unggulan</a>
                    </li>
                    <!-- <li class="nav-item">
                         <a href="#" class="nav-link">Zona Integritas</a>
                    </li> -->
                    <li class="nav-item">
                         <a href="#" class="nav-link smoothScroll">Unduhan</a>
                    </li>
                    <li class="nav-item">
                         <a href="contact.php" class="nav-link ">Kontak</a>
                    </li>
                    <div class="row px-5">
          <div class="col px-5">
               <ul class="navbar-nav float-right">
                    <li class="nav-item">               
                         <a href="https://www.instagram.com/disperdagin_kotakediri?igsh=ZDhvNmF0NXlpempr" target="blank">
                              <img src="images/ig-icons.png" class="img-thumbnail w-75 border-0" alt="">
                         </a>
                    </li>
                    <li class="nav-item">               
                         <a href="https://www.instagram.com/disperdagin_kotakediri?igsh=ZDhvNmF0NXlpempr" target="blank">
                              <img src="images/fb-icons.png" class="img-thumbnail w-75 border-0" alt="">
                         </a>
                    </li>
               </ul>
          </div>
     </div>
                    <div class="scroll-up-icon">
                         <i class="fa fa-arrow-up"></i>
                    </div>
               </ul>
          </div>
     </div>
</div>
</nav>

     <!-- /*---------------------------------------
 Grafik Content 
-----------------------------------------*/ -->
<div class="container">
    <div class="row">
        <div class="col-lg-6 col-md-7 col-12">
            <h1> <strong class="gradient-text" data-aos="fade-up" data-aos-delay="100">Grafik Harga Pasar</strong></h1>
            
            <div class="quote" data-aos="fade-up" data-aos-delay="200"></div>
            
            <h3 class="mb-4" data-aos="fade-up" data-aos-delay="300"></h3>
        </div>
    </div>
</div>

     <?php
$conn = mysqli_connect('localhost', 'root', '', 'data_harga_pokok');

// Check the connection
if (!$conn) {
  die("Connection failed: " . mysqli_connect_error());
}

if (isset($_POST['filter']) && !empty($_POST['filter'])) {
  $filter_values = $_POST['filter'];

  // Membuat string untuk klausa IN
  $in_clause = implode(",", array_map(function ($value) {
    return "'" . $value . "'";
  }, $filter_values));


  // Your SQL query
  $sql = "SELECT
           data_harga_barang.nama_barang,
           data_harga_barang.tanggal,
           data_harga_barang.harga_sekarang
        FROM
           data_harga_barang
        WHERE nama_barang IN ($in_clause)
        ORDER BY
            nama_barang, tanggal";

  // Execute the query
  $result = mysqli_query($conn, $sql);

  // Initialize arrays to store the grouped data
  $tanggal = array();
  $datasets = array();

  // Fetch and organize the data
  while ($row = mysqli_fetch_assoc($result)) {
    $productName = $row['nama_barang'];
    $date = $row['tanggal'];
    $price = $row['harga_sekarang'];

    // Add date to 'tanggal' array if not exists
    if (!in_array($date, $tanggal)) {
      $tanggal[] = $date;
    }

    // Add product to 'datasets' array if not exists
    if (!isset($datasets[$productName])) {
      $datasets[$productName] = array(
        'label' => $productName,
        'data' => array()
      );
    }

    // Add price entry for the product
    $datasets[$productName]['data'][] = $price;
  }

  // Close the database connection
  mysqli_close($conn);

  // Convert the PHP arrays to JSON
  $jsonData = json_encode(array(
    'tanggal' => $tanggal,
    'dataset' => array_values($datasets)
  ), JSON_PRETTY_PRINT);
} ?>
  

  <div class="container mt-5 mb-5" data-aos="fade-up" data-aos-delay="100">
    <button type="button" onclick="goBack()" class="btn btn-primary ms-auto button blob">Kembali</button>
    <canvas id="lineChart"></canvas>
  </div>

  <script>
    // Your JSON data here
    const jsonData = <?php echo $jsonData; ?>;

    // Prepare data for Chart.js
    const labels = jsonData.tanggal;
    const datasets = jsonData.dataset.map(dataset => ({
      label: dataset.label,
      data: dataset.data.map(value => parseInt(value, 10)), // Convert string to integer
      fill: false,
      borderColor: getRandomColor(), // Helper function to generate random color
    }));

    // Create Line Chart
    let delayed;
    const ctx = document.getElementById('lineChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: datasets,
      },
      options: {
        raidus: 5,
        hitRadius: 100,
        hoverRadius: 10,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        animation: {
          onComplete: () => {
            delayed = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayed) {
              delay = context.dataIndex * 80 + context.datasetIndex * 100;
            }
            return delay;
          },
        },
        layout: {
          padding: 20
        },
        legend: true,
        tension: 0.4,
        responsive: true,
        scales: {
          y: {
            beginAtZero: false,
            ticks: {
              callback: function(value, index, values) {
                // Format nilai dengan menambahkan satuan Rupiah (IDR)
                return 'Rp. ' + value.toLocaleString('id-ID');
              }
            }
          }
        },
        x: {
          type: 'time',
          time: {
            unit: 'day'
          }
        }
      }
    });

    // Helper function to generate a random color
    function getRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    function goBack() {
      window.history.back();
    }
  </script>
<!-- /*---------------------------------------
 footer            
-----------------------------------------*/ -->
     <footer class="site-footer">
          <div class="container">
               <div class="row">

                    <div class="col-lg-5 mx-lg-auto col-md-8 col-10">
                         <h1 class="text-white custom-color" data-aos="fade-up" data-aos-delay="100">
                              Disperdagin
                              <strong class="gradient-text"><br>Kota Kediri</strong>
                         </h1>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12" data-aos="fade-up" data-aos-delay="200">
                         <h4 class="my-4">Contact Info</h4>

                         <p class="mb-1">
                              <i class="fa fa-phone mr-2 footer-icon"></i>
                              +99 080 070 4224
                         </p>

                         <p>
                              <a href="#">
                                   <i class="fa fa-envelope mr-2 footer-icon"></i>
                                   hello@company.com
                              </a>
                         </p>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12" data-aos="fade-up" data-aos-delay="300">
                         <h4 class="my-4">Kantor Kami</h4>

                         <p class="mb-1">
                              <i class="fa fa-home mr-2 footer-icon"></i>
                              Jl. Penanggungan NO. 7, Bandar Lor, Kec. Mojoroto, Kota Kediri, Jawa Timur
                         </p>
                    </div>

                    <div class="col-lg-4 mx-lg-auto text-center col-md-8 col-12" data-aos="fade-up" data-aos-delay="400">
                         <p class="copyright-text">Copyright &copy; 2023 DISPERDAGIN
                              <br>
                    </div>

                    <div class="col-lg-3 mx-lg-auto col-md-6 col-12" data-aos="fade-up" data-aos-delay="600">
                         <ul class="social-icon">
                              <li><a href="#" class="fa fa-instagram"></a></li>
                              <li><a href="#" class="fa fa-twitter"></a></li>
                              <li><a href="#" class="fa fa-dribbble"></a></li>
                              <li><a href="#" class="fa fa-behance"></a></li>
                         </ul>
                    </div>

               </div>
          </div>
     </footer>


     <!-- SCRIPTS -->
     <script src="js/jquery.min.js"></script>
     <script src="js/bootstrap.min.js"></script>
     <script src="js/aos.js"></script>
     <script src="js/owl.carousel.min.js"></script>
     <script src="js/smoothscroll.js"></script>
     <script src="js/custom.js"></script>
     <script src="js/transition.js"></script>
     <script src="js/loader.js"></script>

     <script>
          document.addEventListener('DOMContentLoaded', function() {
               var scrollUpIcon = document.querySelector('.scroll-up-icon');

               // Tampilkan tombol ketika pengguna menggulir ke bawah
               window.addEventListener('scroll', function() {
                    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                         scrollUpIcon.style.display = 'block';
                    } else {
                         scrollUpIcon.style.display = 'none';
                    }
               });

               // Smooth scroll ke atas ketika tombol diklik
               scrollUpIcon.addEventListener('click', function() {
                    smoothScrollToTop();
               });

               // Fungsi untuk melakukan smooth scroll ke atas
               function smoothScrollToTop() {
                    var currentPosition = document.documentElement.scrollTop || document.body.scrollTop;
                    if (currentPosition > 0) {
                         window.requestAnimationFrame(smoothScrollToTop);
                         window.scrollTo(0, currentPosition - currentPosition / 8);
                    }
               }
          });
     </script>

     <script>
          document.addEventListener('DOMContentLoaded', function() {
               // Tombol toggle dropdown minimarket
               var minimarketToggle = document.getElementById('minimarket-dropdown-toggle');
               // Dropdown minimarket
               var minimarketDropdown = document.getElementById('minimarket-dropdown');

               // Tampilkan dropdown minimarket ketika tombol toggle diklik
               minimarketToggle.addEventListener('click', function() {
                    if (minimarketDropdown.style.display === 'none' || minimarketDropdown.style.display === '') {
                         minimarketDropdown.style.display = 'block';
                    } else {
                         minimarketDropdown.style.display = 'none';
                    }
               });

               // Sembunyikan dropdown minimarket saat klik di luar dropdown
               document.addEventListener('click', function(event) {
                    var targetElement = event.target;
                    if (targetElement !== minimarketToggle && targetElement !== minimarketDropdown) {
                         minimarketDropdown.style.display = 'none';
                    }
               });
          });
     </script>


</body>

</html>